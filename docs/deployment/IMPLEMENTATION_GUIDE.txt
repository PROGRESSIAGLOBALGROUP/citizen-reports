================================================================================
GUIA FINAL: DEPLOYMENT NGINX + HTTPS
reportes.progressiagroup.com - 145.79.0.77
================================================================================

CONTENIDO ENTREGADO (Noviembre 4, 2025)
================================================================================

ğŸ“‚ Estructura de Archivos Generados:

scripts/
â”œâ”€â”€ setup_reverse_proxy.sh ..................... Script 1: Instala Nginx + Certbot
â””â”€â”€ enable_https.sh ........................... Script 2: Emite certificado HTTPS

docs/deployment/
â”œâ”€â”€ NGINX_HTTPS_README.md ..................... GuÃ­a general (START HERE)
â”œâ”€â”€ STEP_BY_STEP.md ........................... Instrucciones paso a paso
â”œâ”€â”€ VERIFY.md ................................ Checklist verificaciÃ³n (50+ tests)
â”œâ”€â”€ DNS_NOTES.md ............................. GuÃ­a configuraciÃ³n DNS HostGator
â””â”€â”€ nginx-reportes.progressiagroup.com.conf .. Plantilla config Nginx


VARIABLES CONFIGURADAS
================================================================================

SUBDOMAIN = "reportes"
DOMAIN = "progressiagroup.com"
FQDN = "reportes.progressiagroup.com"
VPS_IP = "145.79.0.77"
APP_PORT = "4000"
APP_HOST = "127.0.0.1"
ADMIN_EMAIL = "admin@progressiagroup.com"

(Todos hardcodeados en scripts - editar si necesitas cambiar)


FLUJO DE IMPLEMENTACIÃ“N (10-15 minutos total)
================================================================================

FASE 1: PREPARACIÃ“N DNS (5 minutos)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Acceder a HostGator Panel:
   https://www.hostgator.com/ â†’ Mi Cuenta â†’ Dominios â†’ progressiagroup.com
   â†’ Administrar DNS

2. Crear Registro A:
   - Host/Nombre: reportes
   - Tipo: A
   - Valor: 145.79.0.77
   - TTL: 300 (segundos)
   - Guardar

3. Esperar propagaciÃ³n:
   Ejecutar en terminal local:
   
   $ dig reportes.progressiagroup.com
   
   Esperar a ver: 145.79.0.77 en secciÃ³n "ANSWER SECTION"
   (TÃ­picamente 5-30 minutos, mÃ¡ximo 48 horas)

4. Verificar (repetir hasta que funcione):
   
   $ dig +short reportes.progressiagroup.com
   145.79.0.77    â† Â¡Ã‰xito! Continuar a Fase 2
   
   O si usa Windows:
   
   C:\> nslookup reportes.progressiagroup.com
   Address: 145.79.0.77    â† Â¡Ã‰xito!


FASE 2: INSTALAR NGINX (3-5 minutos)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. SSH al VPS:
   
   $ ssh root@145.79.0.77
   
   Cambiar "root" si tu usuario es diferente

2. Navegar a scripts:
   
   $ cd /root
   $ mkdir -p deployment
   $ cd deployment

3. Copiar scripts (2 opciones):

   OPCIÃ“N A - Descarga desde URL (si estÃ¡ en GitHub):
   
   $ wget https://raw.githubusercontent.com/PROGRESSIAGLOBALGROUP/citizen-reports/main/scripts/setup_reverse_proxy.sh
   $ wget https://raw.githubusercontent.com/PROGRESSIAGLOBALGROUP/citizen-reports/main/scripts/enable_https.sh
   $ chmod +x *.sh

   OPCIÃ“N B - Copiar manualmente:
   
   Desde tu mÃ¡quina local:
   - Copiar setup_reverse_proxy.sh desde scripts/
   - Copiar enable_https.sh desde scripts/
   - SCP al VPS:
     
     $ scp setup_reverse_proxy.sh root@145.79.0.77:/root/deployment/
     $ scp enable_https.sh root@145.79.0.77:/root/deployment/

4. Ejecutar Script de InstalaciÃ³n:
   
   $ cd /root/deployment
   $ sudo bash setup_reverse_proxy.sh
   
   Esperar salida similar a:
   
   [INFO] Inicando setup de reverse proxy Nginx...
   [INFO] Detectada distribuciÃ³n Debian/Ubuntu (o RHEL)
   [INFO] Actualizando repositorios...
   [INFO] Instalando Nginx...
   [INFO] Instalando Certbot...
   [INFO] Habilitado firewall: UFW
   [INFO] Abriendo puerto 80/tcp...
   [INFO] Abriendo puerto 443/tcp...
   [INFO] Creando archivo de configuraciÃ³n Nginx...
   [INFO] âœ“ Sintaxis Nginx vÃ¡lida
   [INFO] âœ“ Nginx recargado exitosamente
   
   ==========================================
   CONFIGURACIÃ“N COMPLETADA EXITOSAMENTE
   ==========================================
   
   Resultado: âœ… HTTP accesible en puerto 80

5. Verificar HTTP funciona:
   
   $ curl -I http://reportes.progressiagroup.com
   
   Esperado:
   HTTP/1.1 200 OK
   Server: nginx/...
   
   Si error: Revisa logs
   $ sudo tail -20 /var/log/nginx/reportes.progressiagroup.com.error.log


FASE 3: EMITIR CERTIFICADO HTTPS (3-5 minutos)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Ejecutar Script HTTPS:
   
   $ sudo bash enable_https.sh
   
   Esperar salida similar a:
   
   [STEP] Verificando DNS...
   [INFO] âœ“ DNS propagado correctamente
   [STEP] Verificando acceso HTTP...
   [INFO] âœ“ HTTP accesible
   [STEP] Emitiendo certificado Let's Encrypt...
   Executing: certbot --nginx -d reportes.progressiagroup.com ...
   
   ... (preguntas de certbot) ...
   
   Congratulations! Your certificate has been issued.
   
   [INFO] âœ“ Certificado emitido exitosamente
   [INFO] âœ“ Certbot renewal timer activo
   [INFO] âœ“ RenovaciÃ³n dry-run exitosa
   
   ==========================================
   CONFIGURACIÃ“N HTTPS COMPLETADA
   ==========================================

2. Resultado: âœ… HTTPS listo con certificado vÃ¡lido


FASE 4: VERIFICACIÃ“N FINAL (2-3 minutos)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ejecutar estos comandos en VPS:

1. HTTPS Accesible:
   $ curl -I https://reportes.progressiagroup.com
   
   Esperado:
   HTTP/1.1 200 OK
   Server: nginx/...

2. RedirecciÃ³n HTTP â†’ HTTPS:
   $ curl -I http://reportes.progressiagroup.com
   
   Esperado:
   HTTP/1.1 301 Moved Permanently
   Location: https://reportes.progressiagroup.com/

3. Certificado VÃ¡lido:
   $ openssl s_client -connect reportes.progressiagroup.com:443 \
     -servername reportes.progressiagroup.com < /dev/null | \
     openssl x509 -noout -subject -dates
   
   Esperado:
   subject=CN = reportes.progressiagroup.com
   notBefore=Nov  4 12:00:00 2025 GMT
   notAfter=Feb   2 12:00:00 2026 GMT

4. Nginx Sin Errores:
   $ sudo nginx -t
   
   Esperado:
   nginx: the configuration file ... syntax is ok
   nginx: configuration file ... test is successful

5. Firewall Abierto:
   $ sudo ufw status | grep -E "80|443"
   
   Esperado:
   80/tcp                     ALLOW       Anywhere
   443/tcp                    ALLOW       Anywhere

6. RenovaciÃ³n AutomÃ¡tica:
   $ sudo certbot certificates
   
   Esperado:
   Certificate Name: reportes.progressiagroup.com
   Expiry Date: 2026-02-02 ...
   
   $ sudo systemctl status certbot.timer
   
   Esperado:
   â— certbot.timer ... Active: active (waiting)


PRUEBA DESDE NAVEGADOR
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Abre en navegador:
   https://reportes.progressiagroup.com

DeberÃ­as ver:
âœ… Candado verde (certificado HTTPS vÃ¡lido)
âœ… Tu aplicaciÃ³n web cargada
âœ… Sin advertencias de seguridad
âœ… URL en HTTPS (no HTTP)

Si ve HTTP: Recarga pÃ¡gina (Ctrl+Shift+R para cachÃ©)


SI ALGO FALLA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PROBLEMA: "Connection refused" en puerto 80
SOLUCIÃ“N:
$ sudo systemctl start nginx
$ sudo systemctl status nginx


PROBLEMA: DNS no resuelve
SOLUCIÃ“N:
$ dig reportes.progressiagroup.com
Si no muestra 145.79.0.77:
- Espera propagaciÃ³n (hasta 48 horas)
- Verifica registro en HostGator panel
- Intenta con: dig reportes.progressiagroup.com @8.8.8.8


PROBLEMA: "HTTP 502 Bad Gateway" en HTTPS
SOLUCIÃ“N (aplicaciÃ³n no corre en :4000):
$ sudo netstat -tlnp | grep 4000
Si vacÃ­o, inicia tu app en puerto 4000


PROBLEMA: "SSL: CERTIFICATE_VERIFY_FAILED"
SOLUCIÃ“N:
$ sudo certbot renew
$ sudo systemctl reload nginx
Espera 2 minutos y reintenta


PROBLEMA: Nginx no reinicia despuÃ©s de editar config
SOLUCIÃ“N:
$ sudo nginx -t
(Muestra error especÃ­fico en lÃ­nea XX)
Edita: sudo nano /etc/nginx/sites-available/reportes.progressiagroup.com
Recarga: sudo systemctl reload nginx


ARCHIVOS DE REFERENCIA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. NGINX_HTTPS_README.md
   - DescripciÃ³n general
   - Quick start
   - Variables configuradas
   - Troubleshooting

2. STEP_BY_STEP.md
   - Instrucciones detalladas
   - ExplicaciÃ³n de cada paso
   - Resultado esperado en cada fase

3. VERIFY.md
   - 10+ pruebas completas
   - Checklist de verificaciÃ³n
   - Comandos para cada verificaciÃ³n

4. DNS_NOTES.md
   - CÃ³mo configurar DNS en HostGator
   - CÃ³mo verificar propagaciÃ³n
   - Troubleshooting DNS

5. nginx-reportes.progressiagroup.com.conf
   - Plantilla config Nginx
   - Headers proxy
   - WebSocket support


MANTENIMIENTO CONTINUADO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

RENOVACIÃ“N CERTIFICADO (AutomÃ¡tica)
La renovaciÃ³n ocurre automÃ¡ticamente cada mes.
Para verificar manualmente:

$ sudo certbot renew --dry-run
$ sudo certbot certificates

MONITOREO LOGS
Revisar diariamente:

$ sudo tail -50 /var/log/nginx/reportes.progressiagroup.com.error.log
$ sudo journalctl -u nginx -n 20

ACTUALIZACIÃ“N NGINX (Anualmente)
$ sudo apt update && sudo apt upgrade nginx
$ sudo nginx -t
$ sudo systemctl reload nginx


ROLLBACK (Si necesitas revertir)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Antes de cualquier cambio, hacer backup:

$ sudo cp /etc/nginx/sites-available/reportes.progressiagroup.com \
  /root/backup-nginx-config.conf

Si necesitas revertir:

$ sudo cp /root/backup-nginx-config.conf \
  /etc/nginx/sites-available/reportes.progressiagroup.com
$ sudo systemctl reload nginx


SOPORTE Y REFERENCIAS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Nginx Documentation:     https://nginx.org/en/docs/
Certbot Documentation:   https://certbot.eff.org/docs/
Let's Encrypt:          https://letsencrypt.org/
HostGator Help:         https://www.hostgator.com/help

DNS Propagation Check:   https://whatsmydns.net/
SSL Certificate Check:   https://www.ssllabs.com/ssltest/
Nginx Config Validator:  https://www.digitalocean.com/community/tools/nginx


RESUMEN ARQUITECTURA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Flujo de una Request:

[Cliente en Internet]
         â†“ HTTPS
[145.79.0.77:443] â† Firewall permite entrada
         â†“
    [Nginx]
   - Reverse Proxy
   - SSL/TLS termination
   - Load balance (si aplica)
         â†“ HTTP interno
   [127.0.0.1:4000]
   - AplicaciÃ³n web
   - Loopback (no pÃºblico)
         â†“ Response
   [Client]
   - HTTPS con Nginx cert


AUTOMATIZACIÃ“N (Opcional)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Para AUTO-DEPLOY desde GitHub:

1. Crear webhook server (ver webhook-server.js en raÃ­z del proyecto)
2. Configurar en GitHub: Settings â†’ Webhooks â†’ Add webhook
3. URL: http://145.79.0.77:3000/webhook
4. Secret: Generar y asignar
5. Cada push a main â†’ Deploy automÃ¡tico

Comando en VPS:
$ node /root/webhook-server.js &


PREGUNTAS FRECUENTES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

P: Â¿Puedo usar diferentes dominio/IP?
R: SÃ­, edita variables en inicio de scripts:
   SUBDOMAIN="mi-dominio"
   DOMAIN="mi-company.com"
   Etc.

P: Â¿El certificado se renueva automÃ¡ticamente?
R: SÃ­, systemd timer ejecuta certbot cada mes.
   Verifica con: sudo systemctl status certbot.timer

P: Â¿QuÃ© pasa si Nginx se cae?
R: EstÃ¡ configurado para iniciar con sistema:
   sudo systemctl enable nginx

P: Â¿Puedo usar subdominios mÃºltiples?
R: SÃ­, pero crea records A separados en HostGator:
   reportes â†’ 145.79.0.77
   admin â†’ 145.79.0.77
   etc.

P: Â¿Costo de certificado Let's Encrypt?
R: GRATIS (forever). RenovaciÃ³n automÃ¡tica tambiÃ©n gratis.

P: Â¿Puedo acceder a la app por IP directa?
R: SÃ­: http://145.79.0.77:80 funciona igual.
   Pero HTTPS solo funciona por dominio (certificado especÃ­fico).


CHECKLIST FINAL (Before Going Live)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INFRAESTRUCTURA:
â˜ VPS 145.79.0.77 accesible por SSH
â˜ Puertos 80 y 443 abiertos
â˜ AplicaciÃ³n corriendo en 127.0.0.1:4000
â˜ Linux: Debian/Ubuntu o RHEL-like

DNS:
â˜ A record creado en HostGator
â˜ Host: reportes, IP: 145.79.0.77
â˜ DNS propagado (dig muestra 145.79.0.77)

NGINX:
â˜ setup_reverse_proxy.sh ejecutado exitosamente
â˜ HTTP accesible: curl http://reportes... â†’ 200
â˜ Nginx no muestra errores: sudo nginx -t âœ“

HTTPS:
â˜ enable_https.sh ejecutado exitosamente
â˜ HTTPS accesible: curl https://reportes... â†’ 200
â˜ Certificado vÃ¡lido (openssl s_client ... âœ“)
â˜ Certificado es de Let's Encrypt
â˜ RedirecciÃ³n 80â†’443 activa

RENOVACIÃ“N:
â˜ Certbot timer activo: sudo systemctl status certbot.timer
â˜ RenovaciÃ³n dry-run exitosa: sudo certbot renew --dry-run âœ“
â˜ Certificado expira 60+ dÃ­as en futuro

PRODUCIÃ“N:
â˜ Logs sin errores: tail /var/log/nginx/*.error.log
â˜ Firewall estÃ¡ activo: sudo ufw status
â˜ Nginx estÃ¡ enabled: sudo systemctl is-enabled nginx
â˜ Se documentÃ³ IP y credenciales en lugar seguro
â˜ Equipo notificado del cambio


TIMESTAMP DEPLOYMENT
================================================================================

Initiated: 2025-11-04
Status: âœ… READY FOR PRODUCTION
Version: 1.0
Team: GitHub Copilot / AI Agent

================================================================================
END OF GUIDE
================================================================================
