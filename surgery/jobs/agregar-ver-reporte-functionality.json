{
  "job_name": "agregar-ver-reporte-functionality",
  "description": "Integrar componente VerReporte con routing y botón en popup de mapa",
  "files_to_modify": [
    {
      "file": "client/src/App.jsx",
      "changes": [
        {
          "type": "import_addition",
          "line": 6,
          "new_code": "import VerReporte from './VerReporte.jsx';"
        },
        {
          "type": "state_addition",
          "after_line": 10,
          "new_code": "  const [reporteIdActual, setReporteIdActual] = useState(null);"
        },
        {
          "type": "routing_update",
          "search": "} else if (hash === '#panel') {",
          "add_before": "} else if (hash.startsWith('#reporte/')) {\n        const id = hash.replace('#reporte/', '');\n        setReporteIdActual(id);\n        setCurrentView('ver-reporte');\n      ",
          "description": "Agregar routing para vista de reporte individual"
        },
        {
          "type": "prop_addition",
          "search": "<SimpleApp />",
          "replace_with": "<SimpleApp usuario={usuario} onVerReporte={(id) => { window.location.hash = `#reporte/${id}`; }} />",
          "description": "Pasar usuario y callback a SimpleApp"
        },
        {
          "type": "view_addition",
          "search": "{currentView === 'admin' && (",
          "add_after": "\n\n      {currentView === 'ver-reporte' && reporteIdActual && (\n        <VerReporte \n          reporteId={reporteIdActual}\n          usuario={usuario}\n          onVolver={() => { window.location.hash = ''; }}\n        />\n      )}\n",
          "description": "Agregar renderizado condicional de VerReporte"
        }
      ]
    },
    {
      "file": "client/src/SimpleApp.jsx",
      "changes": [
        {
          "type": "props_update",
          "search": "export default function SimpleApp() {",
          "replace_with": "export default function SimpleApp({ usuario = null, onVerReporte = null }) {",
          "description": "Agregar props usuario y onVerReporte"
        },
        {
          "type": "prop_pass",
          "search": "<SimpleMapView \n            reportes={reportesVisibles} \n            filtrosActivos={filtrosActivos}\n            tiposInfo={TIPOS_INFO}\n          />",
          "replace_with": "<SimpleMapView \n            reportes={reportesVisibles} \n            filtrosActivos={filtrosActivos}\n            tiposInfo={TIPOS_INFO}\n            usuario={usuario}\n            onVerReporte={onVerReporte}\n          />",
          "description": "Pasar props a SimpleMapView"
        }
      ]
    },
    {
      "file": "client/src/SimpleMapView.jsx",
      "changes": [
        {
          "type": "props_update",
          "search": "function SimpleMapView({ reportes = [], filtrosActivos = [], tiposInfo = {}, forceUpdate = 0 }) {",
          "replace_with": "function SimpleMapView({ reportes = [], filtrosActivos = [], tiposInfo = {}, forceUpdate = 0, usuario = null, onVerReporte = null }) {",
          "description": "Agregar props usuario y onVerReporte"
        },
        {
          "type": "popup_modification",
          "search_start": "const marker = L.marker([latFinal, lngFinal], { icon: customIcon })\n            .bindPopup(`",
          "search_end": "            `);",
          "description": "Agregar botón Ver Reporte en popup si usuario logueado y reporte es de su dependencia",
          "note": "Este cambio debe hacerse en el código del popup, agregando un botón condicional basado en usuario.dependencia === reporte.dependencia"
        }
      ]
    }
  ],
  "test_plan": [
    "1. Login como funcionario de obras_publicas",
    "2. Ver mapa y hacer click en reporte de obras_publicas",
    "3. Verificar que aparece botón 'Ver Reporte' en popup",
    "4. Click en botón debe navegar a #reporte/:id",
    "5. Debe mostrar VerReporte component con datos del reporte",
    "6. Si funcionario está asignado, puede editar notas",
    "7. Si no está asignado, ve mensaje de 'no puedes editar'",
    "8. Botón 'Volver' debe regresar al mapa"
  ],
  "priority": "high",
  "estimated_complexity": "medium"
}
